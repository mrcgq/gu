<!-- =============================================================================
     文件: Dialogs/ServerEditDialog.xaml
     描述: 服务器配置编辑对话框
============================================================================= -->
<UserControl x:Class="PhantomGUI.Dialogs.ServerEditDialog"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             Width="500">
    
    <StackPanel Margin="24">
        <TextBlock Text="编辑服务器" 
                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                   Margin="0,0,0,24"/>
        
        <!-- 基础设置 -->
        <TextBlock Text="基础设置" 
                   Style="{StaticResource MaterialDesignSubtitle2TextBlock}"
                   Margin="0,0,0,8"/>
        
        <TextBox materialDesign:HintAssist.Hint="服务器名称"
                 Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                 Margin="0,0,0,16"/>
        
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="120"/>
            </Grid.ColumnDefinitions>
            
            <TextBox Grid.Column="0"
                     materialDesign:HintAssist.Hint="服务器地址"
                     Text="{Binding ServerAddress, UpdateSourceTrigger=PropertyChanged}"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     Margin="0,0,8,0"/>
            
            <TextBox Grid.Column="1"
                     materialDesign:HintAssist.Hint="端口"
                     Text="{Binding ServerPort, UpdateSourceTrigger=PropertyChanged}"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
        </Grid>
        
        <!-- PSK 密钥 -->
        <Grid Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBox Grid.Column="0"
                     materialDesign:HintAssist.Hint="PSK 密钥 (Base64)"
                     Text="{Binding PSK, UpdateSourceTrigger=PropertyChanged}"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     FontFamily="Consolas"
                     Margin="0,0,8,0"/>
            
            <Button Grid.Column="1"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Content="生成"
                    Command="{Binding GeneratePSKCommand}"/>
        </Grid>
        
        <!-- 传输设置 -->
        <TextBlock Text="传输设置" 
                   Style="{StaticResource MaterialDesignSubtitle2TextBlock}"
                   Margin="0,24,0,8"/>
        
        <ComboBox materialDesign:HintAssist.Hint="传输模式"
                  SelectedValue="{Binding TransportMode}"
                  SelectedValuePath="Tag"
                  Style="{StaticResource MaterialDesignOutlinedComboBox}"
                  Margin="0,0,0,16">
            <ComboBoxItem Content="自动选择" Tag="auto"/>
            <ComboBoxItem Content="UDP (标准)" Tag="udp"/>
            <ComboBoxItem Content="FakeTCP (绕过QoS)" Tag="faketcp"/>
            <ComboBoxItem Content="WebSocket (CDN友好)" Tag="websocket"/>
            <ComboBoxItem Content="eBPF (内核加速)" Tag="ebpf"/>
        </ComboBox>
        
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <TextBox Grid.Column="0"
                     materialDesign:HintAssist.Hint="上行带宽 (Mbps)"
                     Text="{Binding UploadMbps, UpdateSourceTrigger=PropertyChanged}"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     Margin="0,0,8,0"/>
            
            <TextBox Grid.Column="1"
                     materialDesign:HintAssist.Hint="下行带宽 (Mbps)"
                     Text="{Binding DownloadMbps, UpdateSourceTrigger=PropertyChanged}"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
        </Grid>
        
        <!-- TLS 伪装设置 -->
        <TextBlock Text="TLS 伪装" 
                   Style="{StaticResource MaterialDesignSubtitle2TextBlock}"
                   Margin="0,24,0,8"/>
        
        <CheckBox Content="启用 TLS 指纹伪装"
                  IsChecked="{Binding TLSEnabled}"
                  Margin="0,0,0,16"/>
        
        <StackPanel Visibility="{Binding TLSEnabled, 
                        Converter={StaticResource BoolToVisibility}}">
            <TextBox materialDesign:HintAssist.Hint="SNI 域名 (伪装目标)"
                     Text="{Binding TLSServerName, UpdateSourceTrigger=PropertyChanged}"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     Margin="0,0,0,16"/>
            
            <ComboBox materialDesign:HintAssist.Hint="浏览器指纹"
                      SelectedValue="{Binding TLSFingerprint}"
                      SelectedValuePath="Tag"
                      Style="{StaticResource MaterialDesignOutlinedComboBox}">
                <ComboBoxItem Content="Chrome" Tag="chrome"/>
                <ComboBoxItem Content="Firefox" Tag="firefox"/>
                <ComboBoxItem Content="Safari" Tag="safari"/>
                <ComboBoxItem Content="iOS" Tag="ios"/>
                <ComboBoxItem Content="Android" Tag="android"/>
                <ComboBoxItem Content="Edge" Tag="edge"/>
                <ComboBoxItem Content="QQ 浏览器" Tag="qq"/>
                <ComboBoxItem Content="360 浏览器" Tag="360"/>
            </ComboBox>
        </StackPanel>
        
        <!-- 本地代理设置 -->
        <TextBlock Text="本地代理" 
                   Style="{StaticResource MaterialDesignSubtitle2TextBlock}"
                   Margin="0,24,0,8"/>
        
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <TextBox Grid.Column="0"
                     materialDesign:HintAssist.Hint="SOCKS5 端口"
                     Text="{Binding LocalSocksPort, UpdateSourceTrigger=PropertyChanged}"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     Margin="0,0,8,0"/>
            
            <TextBox Grid.Column="1"
                     materialDesign:HintAssist.Hint="HTTP 端口"
                     Text="{Binding LocalHttpPort, UpdateSourceTrigger=PropertyChanged}"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
        </Grid>
        
        <!-- 高级设置 -->
        <Expander Header="高级设置" Margin="0,24,0,0">
            <StackPanel Margin="0,16,0,0">
                <CheckBox Content="启用 ARQ 可靠传输"
                          IsChecked="{Binding EnableARQ}"
                          Margin="0,0,0,8"/>
                
                <TextBox materialDesign:HintAssist.Hint="时间窗口 (秒)"
                         Text="{Binding TimeWindow, UpdateSourceTrigger=PropertyChanged}"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                         Width="150"
                         HorizontalAlignment="Left"/>
                
                <!-- UserID 预览 -->
                <StackPanel Orientation="Horizontal" Margin="0,16,0,0">
                    <TextBlock Text="UserID: " Opacity="0.7"/>
                    <TextBlock Text="{Binding UserId}" FontFamily="Consolas"/>
                </StackPanel>
            </StackPanel>
        </Expander>
        
        <!-- 按钮 -->
        <StackPanel Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Margin="0,24,0,0">
            <Button Content="取消"
                    Style="{StaticResource MaterialDesignFlatButton}"
                    Command="{x:Static materialDesign:DialogHost.CloseDialogCommand}"
                    CommandParameter="False"
                    Margin="0,0,8,0"/>
            <Button Content="保存"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    Command="{x:Static materialDesign:DialogHost.CloseDialogCommand}"
                    CommandParameter="True"/>
        </StackPanel>
    </StackPanel>
</UserControl>


